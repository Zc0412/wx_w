(e=>{const t=new Date,{navigator:{language:o},location:{hostname:n,pathname:r,search:a},document:i,history:s}=e;let c;a&&(c=a.split("=")),console.log("track\u6267\u884c\u4e86");const l="/api/loggers/frontend",d=Math.random().toString();let g=Math.random().toString(),h=`${r}${a}`;const p=e=>{fetch(`${l}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event_time:t,event:"view",event_location:"product_page",event_duration:Math.random().toString(),ip_address:"192.168.1.9",trace_id:Math.random().toString(),login_id:0,properties:{url:e,language:o,hostname:n,referrer:i.referrer,visitorID:d}})}).then((e=>e.json())).then((e=>g=e.id)).catch((e=>console.log(e)))},v=(e=[])=>{let r=performance.now();return()=>{if("hidden"===i.visibilityState){e.push(performance.now()-r);const a=new Blob([JSON.stringify({event_time:t,event:"view",event_location:"product_page",event_duration:Math.random().toString(),ip_address:"192.168.1.9",trace_id:Math.random().toString(),login_id:0,properties:{language:o,hostname:n,referrer:i.referrer,visitorID:d}})],{type:"application/json; charset=UTF-8"}),s=navigator.sendBeacon(`${l}`,a);s&&console.log("navigator.sendBeacon\u6267\u884c\u6210\u529f")}else r=performance.now()}};p(h);const m=v();i.addEventListener("visibilitychange",m);const u=()=>{const e=s.pushState;return(...t)=>{const[,,o]=t;return o!==h&&(h=o,p(o)),e.apply(s,t)}};s.pushState=u();const f=(e,o)=>{const[,n]=c??[],r={event_time:t,trace_id:n||Math.random().toString(),event:e,context:{value:o}};fetch(`${l}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then((e=>e.json())).catch((e=>console.log(e)))},S=()=>{console.log(i),console.log(i.querySelectorAll("[class*='track--']")),i.querySelectorAll("[class*='track--']").forEach((e=>{console.log(2),e.className.split(" ").forEach((t=>{if(console.log(e),/^track--([a-z]+)--([\w]+[\w-]*)$/.test(t)){console.log(t);const[,o,n]=t.split("--"),r=()=>f(o,n);e.addEventListener(o,r,!0)}}))}))};S()})(window);